from pykalman import KalmanFilter
import numpy as np
import matplotlib.pyplot as plt
import time

measurements = np.asarray([(54.907135, 11.8750416), (54.9072966, 11.875096600000001), (54.9074549, 11.875156599999999), (54.907613299999994, 11.8752183), (54.907771600000004, 11.8752816), (54.9079249, 11.8753483), (54.90807660000001, 11.8754149), (54.90822829999999, 11.875471600000001), (54.90838000000001, 11.8755366), (54.908535, 11.8755966), (54.9086816, 11.875661599999999), (54.908828299999996, 11.8757216), (54.9089733, 11.8757783), (54.9091216, 11.87583), (54.909269900000005, 11.875875), (54.9094216, 11.875914999999999), (54.90957829999999, 11.87595), (54.9097399, 11.87598), (54.909901600000005, 11.876005000000001), (54.910061600000006, 11.876026600000001), (54.9102183, 11.876045), (54.9102183, 11.876045), (54.910525, 11.876078300000001), (54.910525, 11.876078300000001), (54.910801600000006, 11.8760983), (54.9109216, 11.87611), (54.911025, 11.8761166), (54.9111183, 11.8761216), (54.911191599999995, 11.8760966), (54.911235, 11.8760383), (54.91125329999999, 11.875945), (54.91125329999999, 11.875945), (54.9112933, 11.875698300000002), (54.911319999999996, 11.8755616), (54.9113466, 11.875423300000001), (54.91138, 11.875278300000002), (54.911416599999995, 11.875124900000001), (54.91145160000001, 11.874965), (54.91149, 11.8747983), (54.911525, 11.87463), (54.91156329999999, 11.8744583), (54.91156329999999, 11.8744583), (54.911634899999996, 11.874118300000001), (54.911675, 11.8739416), (54.9117166, 11.873758300000002), (54.911765, 11.873569900000001), (54.911765, 11.873569900000001), (54.91181329999999, 11.873381599999998), (54.911859899999996, 11.8731883), (54.911913299999995, 11.872976600000001), (54.911913299999995, 11.872976600000001), (54.911965, 11.8727633), (54.911965, 11.8727633), (54.9120733, 11.8723216), (54.9120733, 11.8723216), (54.91212829999999, 11.8720966), (54.912178299999994, 11.8718766), (54.912178299999994, 11.8718766), (54.9122316, 11.8716549), (54.9122816, 11.87143), (54.9122816, 11.87143), (54.9122816, 11.87143), (54.91237829999999, 11.8709716), (54.912425, 11.870733300000001), (54.912425, 11.870733300000001), (54.912465000000005, 11.870495), (54.91250329999999, 11.8702516), (54.912538299999994, 11.8700116), (54.912538299999994, 11.8700116), (54.9125983, 11.8695416), (54.91263000000001, 11.8693116), (54.91266329999999, 11.8690866), (54.91269499999999, 11.8688733), (54.9127233, 11.8686766), (54.91275329999999, 11.868488300000001), (54.91277660000001, 11.868329899999999), (54.9127966, 11.8681883), (54.912815, 11.868068300000001), (54.912815, 11.868068300000001), (54.9128299, 11.8679), (54.9128216, 11.8678433), (54.9127983, 11.8678016), (54.912768299999996, 11.86777), (54.9127316, 11.8677466), (54.91268829999999, 11.8677299), (54.91264159999999, 11.8677183), (54.9125933, 11.867708300000002), (54.9125416, 11.8676983), (54.9124866, 11.867686599999999), (54.912428299999995, 11.867675), (54.9123716, 11.8676633), (54.912315, 11.86765), (54.912259999999996, 11.8676383), (54.912203299999994, 11.8676266), (54.912144999999995, 11.867614999999999), (54.912084899999996, 11.8676033), (54.9120233, 11.867591599999999), (54.911958299999995, 11.867579899999999), (54.911893299999996, 11.867569999999999), (54.911825, 11.8675533), (54.911825, 11.8675533), (54.9116866, 11.8675233), (54.91161329999999, 11.8675083), (54.91154, 11.8674916), (54.9114649, 11.867475), (54.9114649, 11.867475), (54.9114649, 11.867475), (54.911306599999996, 11.8674399), (54.911225, 11.86742), (54.91114159999999, 11.867398300000001), (54.9110566, 11.8673799), (54.91096999999999, 11.8673666), (54.9108833, 11.867361599999999), (54.910793299999995, 11.8673683), (54.9107016, 11.8673916), (54.910605000000004, 11.8674316), (54.91051160000001, 11.8674766), (54.910418299999996, 11.867533300000002), (54.9103233, 11.8675899), (54.910230000000006, 11.8676483), (54.910135, 11.867705), (54.91004, 11.867758300000002), (54.909941599999996, 11.867808300000002), (54.90983829999999, 11.8678533), (54.909726600000006, 11.8678866), (54.9096166, 11.867925), (54.9094983, 11.8679566), (54.90937660000001, 11.867989999999999), (54.909253299999996, 11.86802), (54.909125, 11.86805), (54.908995, 11.86808), (54.90886329999999, 11.868111599999999), (54.908731599999996, 11.868158300000001), (54.9085966, 11.868198300000001), (54.90846, 11.8682366), (54.908325, 11.868278300000002), (54.908190000000005, 11.8683183), (54.9080566, 11.8683583), (54.9079233, 11.8683983), (54.907791599999996, 11.8684383), (54.907661600000004, 11.86847), (54.9075333, 11.8685033), (54.9074083, 11.8685383), (54.90729, 11.8685683), (54.907175, 11.8686), (54.90706329999999, 11.8686299), (54.90695, 11.8686616), (54.906836600000005, 11.8686933), (54.906721600000004, 11.8687266), (54.90660329999999, 11.868758300000001), (54.906484999999996, 11.868789999999999), (54.90636329999999, 11.8688233), (54.90623829999999, 11.868858300000001), (54.9061116, 11.8688933), (54.905983299999995, 11.8689299), (54.9058533, 11.8689666), (54.905719999999995, 11.8690016), (54.905583299999996, 11.8690383), (54.905441599999996, 11.869078300000002), (54.9052966, 11.8691183), (54.9051483, 11.8691616), (54.905, 11.869205000000001), (54.90485160000001, 11.8692466), (54.9047, 11.86929), (54.90455, 11.869331599999999), (54.90440160000001, 11.8693766), (54.904255000000006, 11.869418300000001), (54.904109999999996, 11.8694566), (54.903968299999995, 11.8694916), (54.903833299999995, 11.8695233), (54.903705, 11.8695566), (54.903580000000005, 11.8695866), (54.903459899999994, 11.8696166), (54.9033416, 11.869648300000001), (54.9032216, 11.8696816), (54.90310160000001, 11.869715), (54.9029816, 11.8697466), (54.90286329999999, 11.869778300000002), (54.9027483, 11.8698083), (54.902634899999995, 11.8698399), (54.90252660000001, 11.8698716), (54.9024233, 11.869899900000002), (54.90232660000001, 11.86993), (54.902235, 11.8699533), (54.9021499, 11.8699633), (54.902068299999996, 11.8699516), (54.9019866, 11.8699183), (54.901908299999995, 11.8698716), (54.901830000000004, 11.8698183), (54.9017583, 11.8697583), (54.9016933, 11.869706599999999), (54.901638299999995, 11.869656599999999), (54.901596600000005, 11.8696183), (54.901569900000005, 11.869595), (54.9015566, 11.869583300000002), (54.9015483, 11.8695766), (54.901541599999995, 11.8695783), (54.9015216, 11.869595), (54.901495, 11.8696366), (54.9014733, 11.8697183), (54.9014583, 11.869824900000001), (54.901444999999995, 11.869943300000001), (54.901430000000005, 11.8700699), (54.9014166, 11.87021), (54.9014066, 11.8703633), (54.9014, 11.8705383), (54.901398300000004, 11.870719900000001), (54.90140160000001, 11.8708966), (54.9014, 11.87107), (54.901393299999995, 11.871248300000001), (54.9013833, 11.87144), (54.90137829999999, 11.871615), (54.901375, 11.871773300000001), (54.901371600000004, 11.87192), (54.901365000000006, 11.872053300000001), (54.9013533, 11.8721633), (54.90135, 11.8722316), (54.9013483, 11.872269900000001), (54.90134499999999, 11.872286599999999), (54.901351600000005, 11.872288300000001), (54.9013566, 11.872299900000002), (54.9013566, 11.872299900000002), (54.9013566, 11.872299900000002), (54.9013566, 11.872299900000002), (54.9013566, 11.872299900000002), (54.9013566, 11.872299900000002), (54.9013566, 11.872299900000002), (54.9013566, 11.872299900000002), (54.901375, 11.8723933), (54.90141, 11.872435000000001), (54.90145989999999, 11.872475), (54.901525, 11.872503300000002), (54.901605, 11.872525), (54.9016983, 11.87255), (54.901801600000006, 11.8725799), (54.901915, 11.8726266), (54.9020333, 11.872685), (54.90216329999999, 11.8727516), (54.9022983, 11.872828300000002), (54.9024366, 11.8729083), (54.9025816, 11.872995), (54.902731599999996, 11.873085000000001), (54.9028866, 11.8731749), (54.90304989999999, 11.873268300000001), (54.9032183, 11.8733516), (54.9033933, 11.87343), (54.9035733, 11.873508300000001), (54.9037566, 11.873585), (54.903943299999995, 11.873664999999999), (54.904134899999995, 11.873743300000001), (54.904328299999996, 11.873826600000001), (54.904525, 11.8739116), (54.9047249, 11.8739966), (54.9049266, 11.874081599999998), (54.905128299999994, 11.8741666), (54.90532660000001, 11.87425), (54.9055233, 11.87433), (54.90571329999999, 11.874410000000001), (54.9058966, 11.874485), (54.906071600000004, 11.874558300000002), (54.906240000000004, 11.874626600000001), (54.906403299999994, 11.8746966), (54.906563299999995, 11.8747633), (54.90671329999999, 11.8748283), (54.9068549, 11.8748883), (54.9069816, 11.8749433), (54.907094900000004, 11.874989900000001), (54.90719, 11.8750183), (54.90726329999999, 11.875055), (54.907341599999995, 11.8750933), (54.9074116, 11.8751233), (54.90747660000001, 11.8751516), (54.907534999999996, 11.8751799), (54.90759, 11.8751866), (54.907635, 11.875169900000001), (54.9076683, 11.8751366), (54.9076933, 11.87509), (54.907709999999994, 11.8750299), (54.90772, 11.8749683), (54.907725, 11.874911599999999), (54.907725, 11.874866599999999), (54.907725, 11.874866599999999), (54.907725, 11.8748466), (54.907726600000004, 11.874839900000001), (54.907726600000004, 11.874839900000001), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907725, 11.8748416), (54.907741599999994, 11.875701600000001), (54.9078666, 11.875326600000001), (54.9078583, 11.87534), (54.907844999999995, 11.875331599999999), (54.9078199, 11.875338300000001), (54.9077616, 11.875364999999999), (54.9077616, 11.875364999999999), (54.9077616, 11.875364999999999), (54.9077616, 11.875364999999999), (54.9077616, 11.875364999999999), (54.9077616, 11.875364999999999), (54.9077616, 11.875364999999999), (54.9077616, 11.875364999999999), (54.9077616, 11.875364999999999), (54.9077616, 11.875364999999999), (54.9077616, 11.875364999999999), (54.9077616, 11.875364999999999), (54.906093299999995, 11.8751516), (54.905765, 11.875148300000001), (54.90551329999999, 11.8751416), (54.9052666, 11.875133300000002), (54.905030000000004, 11.875148300000001), (54.90480989999999, 11.875145), (54.904596600000005, 11.87513), (54.904455000000006, 11.8749466), (54.9042966, 11.8747933), (54.9040983, 11.8746433), (54.9038816, 11.874485), (54.903606599999996, 11.8742683), (54.90335, 11.874158300000001), (54.90286329999999, 11.873823300000002), (54.9025766, 11.8734166), (54.9023233, 11.873280000000001), (54.9020983, 11.87317), (54.90189, 11.8730716), (54.9017183, 11.8722849), (54.901525, 11.8721966), (54.901340000000005, 11.872114999999999), (54.9011533, 11.8721266), (54.9009833, 11.8721166), (54.900830000000006, 11.8721316), (54.9006833, 11.8721516), (54.90055329999999, 11.8721716), (54.90042, 11.8722016), (54.900285, 11.8722049), (54.90012829999999, 11.8723466), (54.8999916, 11.8723416), (54.8998566, 11.872308300000002), (54.899713299999995, 11.8722416), (54.899561600000006, 11.872160000000001), (54.8994066, 11.872069900000001), (54.89924499999999, 11.8719799), (54.899074899999995, 11.871901600000001), (54.89890329999999, 11.871825), (54.898711600000006, 11.8717883), (54.8985316, 11.8717149), (54.898355, 11.87163), (54.8981816, 11.871525), (54.89801, 11.8714133), (54.89784, 11.87129), (54.8976683, 11.871163300000001), (54.8975, 11.871030000000001), (54.8973333, 11.870883300000001), (54.8971733, 11.8707166), (54.897014899999995, 11.87053), (54.896855, 11.870315), (54.8966966, 11.8700883), (54.89653829999999, 11.869845), (54.896384999999995, 11.8695866), (54.896235, 11.869314900000001), (54.896094999999995, 11.8690266), (54.895959999999995, 11.8687283), (54.8958233, 11.8684249), (54.895681599999996, 11.868113300000001), (54.89553829999999, 11.8677983), (54.895391599999996, 11.867483300000002), (54.8952466, 11.8671716), (54.895103299999995, 11.8668633), (54.895103299999995, 11.8668633), (54.894968299999995, 11.866563300000001), (54.89484, 11.866273300000001), (54.894721600000004, 11.8660133), (54.89460160000001, 11.8657783), (54.8944983, 11.8655549), (54.894405000000006, 11.865345), (54.894321600000005, 11.865158300000001), (54.894255, 11.865), (54.894203299999994, 11.864873300000001), (54.8941666, 11.864755), (54.8941666, 11.864755), (54.89415329999999, 11.8646383), (54.894180000000006, 11.864525), (54.894215, 11.864395), (54.8942566, 11.864261599999999), (54.894301600000006, 11.864073300000001), (54.8943483, 11.863856599999998), (54.8943916, 11.8636166), (54.894436600000006, 11.8633516), (54.8944816, 11.863064900000001), (54.8945366, 11.862756599999999), (54.8945933, 11.862426600000001), (54.8946516, 11.8620783), (54.8947116, 11.8617116), (54.894773300000004, 11.8613316), (54.894836600000005, 11.86094), (54.8949, 11.8605366), (54.894965, 11.860123300000001), (54.8950333, 11.859701600000001), (54.8951049, 11.8592683), (54.89517829999999, 11.8588283), (54.895256599999996, 11.8583866), (54.895328299999996, 11.857933300000001), (54.8953966, 11.857465), (54.895461600000004, 11.8569816), (54.89552, 11.856485000000001), (54.8955733, 11.8559816), (54.895625, 11.855469900000001), (54.89566329999999, 11.854953300000002), (54.89570989999999, 11.8544383), (54.895745, 11.8539166), (54.89578829999999, 11.853399900000001), (54.8958316, 11.8528816), (54.895874899999995, 11.8523616), (54.895915, 11.851844900000001), (54.895951600000004, 11.8513316), (54.8959833, 11.85083), (54.896018299999994, 11.850355), (54.89605329999999, 11.849906599999999), (54.89608489999999, 11.849481599999999), (54.8961149, 11.8490716), (54.89614, 11.84867), (54.896158299999996, 11.8482733), (54.8961733, 11.847883300000001), (54.896184999999996, 11.847498300000002), (54.896184999999996, 11.847498300000002), (54.8961983, 11.8471166), (54.896203299999996, 11.8467383), (54.896205, 11.8463616), (54.896203299999996, 11.845983300000002), (54.896201600000005, 11.8456116), (54.896201600000005, 11.8452433), (54.8961983, 11.844876600000001), (54.896195, 11.844505), (54.896191599999995, 11.844133300000001), (54.89618829999999, 11.8437633), (54.8961816, 11.84339), (54.8961716, 11.8430166), (54.896158299999996, 11.8426416), (54.8961433, 11.8422683), (54.89612660000001, 11.8418966), (54.896106599999996, 11.8415216), (54.8960833, 11.8411483), (54.8960616, 11.8407733), (54.8960366, 11.8403983), (54.8960116, 11.8400216), (54.895984999999996, 11.839644900000001), (54.895959999999995, 11.8392666), (54.895934999999994, 11.838886599999999), (54.895906599999996, 11.838506599999999), (54.895880000000005, 11.838125), (54.89585329999999, 11.83774), (54.89582660000001, 11.8373549), (54.8958033, 11.836956599999999), (54.8957816, 11.8365549), (54.895751600000004, 11.8361683), (54.8957216, 11.8357699), (54.8956933, 11.8353733), (54.89566329999999, 11.8349683), (54.89563489999999, 11.834563300000001), (54.8956066, 11.8341566), (54.8955783, 11.833745), (54.895551600000005, 11.8333349), (54.895526600000004, 11.832925), (54.89550500000001, 11.8325116), (54.895486600000005, 11.8320966), (54.8954716, 11.8316799), (54.895461600000004, 11.8312616), (54.895455000000005, 11.8308433), (54.89545329999999, 11.8304216), (54.895455000000005, 11.8299966), (54.89546329999999, 11.8295716), (54.89547660000001, 11.8291433), (54.8954949, 11.8287133), (54.89551659999999, 11.828278300000001), (54.895541599999994, 11.8278416), (54.895571600000004, 11.8274033), (54.895601600000006, 11.826961599999999), (54.8956316, 11.8265166), (54.895661600000004, 11.8260716), (54.89569, 11.8256266), (54.89571329999999, 11.825175), (54.895736600000006, 11.824725), (54.895755, 11.824275), (54.89577, 11.8238233), (54.8957833, 11.8233716), (54.895796600000004, 11.8229166), (54.89581, 11.822461599999999), (54.895821600000005, 11.821999900000002), (54.8958333, 11.8215366), (54.895844999999994, 11.821069999999999), (54.8958583, 11.8206016), (54.8958683, 11.8201283), (54.89587829999999, 11.8196533), (54.8958899, 11.8191766), (54.89590329999999, 11.8186966), (54.895911600000005, 11.8182116), (54.8959216, 11.8177216), (54.8959316, 11.8172266), (54.89594159999999, 11.816728300000001), (54.895951600000004, 11.816225), (54.895964899999996, 11.815719900000001), (54.895978299999996, 11.815208300000002), (54.895993299999994, 11.814694900000001), (54.89601, 11.8141799), (54.89602829999999, 11.8136633), (54.89605160000001, 11.813145), (54.896080000000005, 11.812628300000002), (54.89611, 11.8121116), (54.8961416, 11.8115966), (54.8961749, 11.8110816), (54.8962083, 11.8105666), (54.89624, 11.810053300000002), (54.896273300000004, 11.8095399), (54.896305000000005, 11.809028300000001), (54.89633829999999, 11.808518300000001), (54.8963733, 11.808008300000001), (54.8964066, 11.8075), (54.896440000000005, 11.8069933), (54.8964699, 11.8064883), (54.89650329999999, 11.8059849), (54.8965333, 11.805481599999998), (54.896564899999994, 11.804985), (54.8965966, 11.8044966), (54.896626600000005, 11.804011599999999), (54.896655, 11.8035349), (54.896655, 11.8035349), (54.8966833, 11.803075), (54.8967116, 11.802633300000002), (54.89674, 11.8022116), (54.8967683, 11.8018166), (54.8967933, 11.8014399), (54.896815000000004, 11.801089900000001), (54.8968366, 11.8007566), (54.8968566, 11.80045), (54.896876600000006, 11.8001716), (54.89690329999999, 11.7999183), (54.896925, 11.799693300000001), (54.896936600000004, 11.7995349), (54.89693829999999, 11.79955), (54.8969483, 11.7994366), (54.8969483, 11.7994366), (54.8969483, 11.7993099), (54.896919999999994, 11.799223300000001), (54.896919999999994, 11.799223300000001), (54.89674, 11.79932), (54.8966399, 11.7993516), (54.89653489999999, 11.7993616), (54.89641999999999, 11.7993716), (54.896288299999995, 11.7993966), (54.896288299999995, 11.7993966), (54.8961466, 11.79942), (54.89601329999999, 11.79945), (54.89601329999999, 11.79945), (54.8958833, 11.7994716), (54.895759999999996, 11.799483300000002), (54.8956483, 11.7995), (54.895551600000005, 11.799511599999999), (54.8954716, 11.7995166), (54.895415, 11.7995233), (54.895371600000004, 11.7995383), (54.89534329999999, 11.79957), (54.89536, 11.7996466), (54.895355, 11.7997183), (54.8953533, 11.7998), (54.895355, 11.799883300000001), (54.8953533, 11.799958300000002), (54.8953533, 11.8000266), (54.89536, 11.8000933), (54.895371600000004, 11.80016), (54.895376600000006, 11.800218300000001), (54.89538, 11.8002733), (54.8953783, 11.800325), (54.89536999999999, 11.80037), (54.895351600000005, 11.8004083), (54.895325, 11.8004383), (54.8952966, 11.8004583), (54.8952666, 11.8004616), (54.89524, 11.8004516), (54.8952216, 11.8004233), (54.895213299999995, 11.8003883), (54.89521, 11.800355), (54.8952083, 11.8003383), (54.8952066, 11.8003383), (54.8952083, 11.80034), (54.8952083, 11.80034), (54.8952083, 11.80034), (54.8952083, 11.80034), (54.8952083, 11.80034), (54.8952083, 11.80034), (54.8952083, 11.80034), (54.8952083, 11.80034), (54.8952083, 11.80034), (54.8952083, 11.80034), (54.8952083, 11.80034), (54.8952083, 11.80034), (54.8952083, 11.80034), (54.8952083, 11.80034), (54.8952083, 11.80034), (54.8952083, 11.80034), (54.8952083, 11.80034), (54.8952083, 11.80034), (54.8952083, 11.80034), (54.8952083, 11.80034), (54.8952083, 11.80034), (54.8952083, 11.80034), (54.8952083, 11.80034), (54.8952083, 11.80034), (54.8952083, 11.80034), (54.8952083, 11.80034), (54.8952083, 11.80034), (54.8952083, 11.80034), (54.8952083, 11.80034), (54.8952083, 11.80034), (54.8952083, 11.80034), (54.8952083, 11.80034), (54.8952083, 11.80034), (54.8952083, 11.80034), (54.8952083, 11.80034), (54.8952083, 11.80034), (54.8952083, 11.80034), (54.8952083, 11.80034), (54.8952083, 11.80034), (54.8952083, 11.80034), (54.8952083, 11.80034), (54.8952083, 11.80034), (54.8952083, 11.80034), (54.8952083, 11.80034), (54.8952083, 11.80034), (54.8952083, 11.80034), (54.8952083, 11.80034), (54.8952083, 11.80034), (54.8952083, 11.80034), (54.8952, 11.8001716), (54.8951949, 11.800166599999999), (54.895188299999994, 11.800165), (54.8951816, 11.8001616), (54.8951816, 11.8001616), (54.8951816, 11.8001616), (54.8951816, 11.8001616), (54.8951816, 11.8001616), (54.8951816, 11.8001616), (54.8951816, 11.8001616), (54.8951816, 11.8001616), (54.8951816, 11.8001616), (54.8951816, 11.8001616), (54.8951816, 11.8001616), (54.8951816, 11.8001616), (54.8951816, 11.8001616), (54.8951816, 11.8001616), (54.8951816, 11.8001616), (54.8951816, 11.8001616), (54.8951816, 11.8001616), (54.8951816, 11.8001616), (54.8951816, 11.8001616), (54.8951816, 11.8001616), (54.8951816, 11.8001616), (54.8951816, 11.8001616), (54.8951816, 11.8001616), (54.8951816, 11.8001616), (54.8951816, 11.8001616), (54.8951816, 11.8001616), (54.8951816, 11.8001616), (54.8951816, 11.8001616), (54.8951816, 11.8001616), (54.8951816, 11.8001616), (54.8951816, 11.8001616), (54.8951816, 11.8001616), (54.8951816, 11.8001616), (54.8951816, 11.8001616), (54.8951816, 11.8001616), (54.8951816, 11.8001616), (54.8951816, 11.8001616), (54.8951816, 11.8001616), (54.8951816, 11.8001616), (54.8951816, 11.8001616), (54.8951816, 11.8001616), (54.8951816, 11.8001616), (54.8951816, 11.8001616), (54.8951816, 11.8001616), (54.8951816, 11.8001616), (54.8951816, 11.8001616), (54.8951816, 11.8001616), (54.8951816, 11.8001616), (54.8951816, 11.8001616), (54.89516999999999, 11.8001283), (54.89516999999999, 11.8001266), (54.8951816, 11.800130000000001), (54.89517829999999, 11.8001333), (54.895175, 11.8001283), (54.895175, 11.8001283), (54.895175, 11.8001283), (54.895175, 11.8001283), (54.895175, 11.8001283), (54.895175, 11.8001283), (54.895175, 11.8001283), (54.895175, 11.8001283), (54.895175, 11.8001283), (54.895175, 11.8001283), (54.895175, 11.8001283), (54.895175, 11.8001283), (54.895175, 11.8001283), (54.895175, 11.8001283), (54.895175, 11.8001283), (54.895175, 11.8001283), (54.895175, 11.8001283), (54.895175, 11.8001283), (54.895175, 11.8001283), (54.895175, 11.8001283), (54.895175, 11.8001283), (54.895175, 11.8001283), (54.895175, 11.8001283), (54.895175, 11.8001283), (54.895175, 11.8001283), (54.895175, 11.8001283), (54.895175, 11.8001283), (54.895175, 11.8001283), (54.895175, 11.8001283), (54.895175, 11.8001283), (54.895175, 11.8001283), (54.895175, 11.8001283), (54.895175, 11.8001283), (54.895175, 11.8001283), (54.895175, 11.8001283), (54.895175, 11.8001283), (54.895175, 11.8001283), (54.895175, 11.8001283), (54.895175, 11.8001283), (54.895175, 11.8001283), (54.895175, 11.8001283), (54.895175, 11.8001283), (54.895175, 11.8001283), (54.895175, 11.8001283), (54.895175, 11.8001283), (54.895175, 11.8001283), (54.895175, 11.8001283), (54.895175, 11.8001283), (54.895175, 11.8001283), (54.895175, 11.8001283), (54.895175, 11.8001283), (54.895175, 11.8001283), (54.8952549, 11.800201600000001), (54.895261600000005, 11.8001983), (54.895265, 11.8001933), (54.895261600000005, 11.8001983), (54.895261600000005, 11.8001983), (54.895261600000005, 11.8001983), (54.895261600000005, 11.8001983), (54.895261600000005, 11.8001983), (54.895261600000005, 11.8001983), (54.895261600000005, 11.8001983), (54.895261600000005, 11.8001983)])
initial_state_mean = [measurements[0, 0],
                      0,
                      measurements[0, 1],
                      0]

transition_matrix = [[1, 1, 0, 0],
                     [0, 1, 0, 0],
                     [0, 0, 1, 1],
                     [0, 0, 0, 1]]

observation_matrix = [[1, 0, 0, 0],
                      [0, 0, 1, 0]]

kf1 = KalmanFilter(transition_matrices = transition_matrix,
                  observation_matrices = observation_matrix,
                  initial_state_mean = initial_state_mean)
kf1 = kf1.em(measurements, n_iter=5)
time_before = time.time()
n_real_time = 3

kf2 = KalmanFilter(transition_matrices = transition_matrix,
                  observation_matrices = observation_matrix,
                  initial_state_mean = initial_state_mean,
                  observation_covariance = 10*kf1.observation_covariance,
                  em_vars=['transition_covariance', 'initial_state_covariance'])

kf2 = kf2.em(measurements[:-n_real_time, :], n_iter=5)
(filtered_state_means, filtered_state_covariances) = kf2.filter(measurements[:-n_real_time,:])

print("Time to build and train kf2: %s seconds" % (time.time() - time_before))

x_now = filtered_state_means[1, :]
P_now = filtered_state_covariances[1, :]
x_new = np.zeros((n_real_time, filtered_state_means.shape[1]))
i = 0

for measurement in measurements[-n_real_time:, :]:
    time_before = time.time()
    (x_now, P_now) = kf2.filter_update(filtered_state_mean = x_now,
                                       filtered_state_covariance = P_now,
                                       observation = measurement)
    print("Time to update kf2: %s seconds" % (time.time() - time_before))
    x_new[i, :] = x_now
    i = i + 1

plt.figure(3)
old_times = range(measurements.shape[0] - n_real_time)
new_times = range(measurements.shape[0]-n_real_time, measurements.shape[0])
plt.plot(old_times, filtered_state_means[:, 0], 'b--',
         old_times, filtered_state_means[:, 2], 'r--',
         new_times, x_new[:, 0], 'b-',
         new_times, x_new[:, 2], 'r-')

plt.show()
latitude = np.array(filtered_state_means[:, 0])
longitude = np.array(filtered_state_means[:, 2])
import pandas as pd
df = pd.DataFrame({'latitude': latitude, 'longitude': list(longitude)}, columns=['latitude', 'longitude'])
print(df)
df.to_csv('C:/Users/mun/Desktop/Research/Ny mappe/Filtered_new1_data.csv')
(smoothed_state_means, smoothed_state_covariances) = kf2.smooth(measurements)
kf3 = KalmanFilter(transition_matrices = transition_matrix,
                  observation_matrices = observation_matrix,
                  initial_state_mean = initial_state_mean,
                  observation_covariance = 15*kf2.observation_covariance,
                  em_vars=['transition_covariance', 'initial_state_covariance'])

kf3 = kf3.em(measurements, n_iter=5)
(smoothed_state_means, smoothed_state_covariances)  = kf3.smooth(measurements)

plt.figure(2)
times = range(measurements.shape[0])
plt.plot(times, measurements[:, 0], 'bo',
         times, measurements[:, 1], 'ro',
         times, smoothed_state_means[:, 0], 'b',
         times, smoothed_state_means[:, 2], 'r',)
plt.show()
plt.figure(1)
times = range(measurements.shape[0])
plt.plot(times, measurements[:, 0], 'bo',
         times, measurements[:, 1], 'ro',
         times, smoothed_state_means[:, 0], 'b--',
         times, smoothed_state_means[:, 1], 'r--',)
plt.figure(2)
plt.figure(2)
latitude = np.array(smoothed_state_means[:, 0])
longitude = np.array(smoothed_state_means[:, 2])
df1 = pd.DataFrame({'latitude': latitude, 'longitude': list(longitude)}, columns=['latitude', 'longitude'])
times = range(measurements.shape[0])
plt.plot(times, measurements[:, 0], 'bo',
         times, smoothed_state_means[:, 0], 'b')
plt.axis([0, 920, 54.7, 55])
plt.show()
times = range(measurements.shape[0])
plt.plot(times, measurements[:, 1], 'ro',
         times, smoothed_state_means[:, 2], 'r--')
plt.axis([0, 920, 11.7, 12])
plt.show()
df1.to_csv('C:/Users/mun/Desktop/Research/Ny mappe/Filtered_smooth_data1.csv')

